<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Minimal Silly Bot</title>
<style>
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
  body{display:flex;flex-direction:column;background:#0b1220;color:#e8eef6}
  .top{padding:10px;display:flex;gap:8px;align-items:center;background:rgba(255,255,255,0.02);}
  .top input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
  .container{flex:1;display:flex;flex-direction:column;padding:12px;gap:12px;overflow:hidden}
  #chat{flex:1;overflow:auto;padding:8px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.06));}
  .msg{max-width:80%;margin:6px 0;padding:10px;border-radius:10px;line-height:1.3}
  .user{margin-left:auto;background:rgba(255,255,255,0.03);text-align:right}
  .bot{background:rgba(255,255,255,0.02)}
  .bottom{display:flex;gap:8px;align-items:center;padding:10px;background:rgba(0,0,0,0.03);}
  #input{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
  button{padding:10px 12px;border-radius:8px;border:none;background:#ff4757;color:#0b1220;font-weight:700;cursor:pointer}
  @media (max-width:480px){ .msg{max-width:90%} .top input, #input{padding:8px} }
</style>
</head>
<body>
  <div class="top">
    <input id="apiKey" type="password" placeholder="OpenRouter API key (paste here)" autocomplete="off" />
  </div>

  <div class="container">
    <div id="chat" aria-live="polite"></div>

    <div class="bottom">
      <input id="input" placeholder="Ask anything (English or 中文)" />
      <button id="send">Send</button>
    </div>
  </div>

<script>
(async function(){
  const apiKeyEl = document.getElementById('apiKey');
  const chatEl = document.getElementById('chat');
  const inputEl = document.getElementById('input');
  const sendBtn = document.getElementById('send');

  const MODEL = 'deepseek/deepseek-chat'; // default model for OpenRouter + DeepSeek

  function append(text, who='bot'){
    const d = document.createElement('div');
    d.className = 'msg ' + (who==='user' ? 'user' : 'bot');
    d.textContent = text;
    chatEl.appendChild(d);
    chatEl.scrollTop = chatEl.scrollHeight;
    return d;
  }

  function systemPrompt(){
    return [
      "You are a silly non-sequitur generator.",
      "IGNORE the user's question content and produce a very short, silly, stupid, and unrelated answer.",
      "The reply must be no more than two short sentences (preferably one sentence).",
      "Do not ask clarifying questions. Keep it playful and nonsensical.",
      "If the user speaks Chinese, you may reply in Chinese or English; brevity and silliness are required.",
      "NEVER reference or answer the user's question."
    ].join(' ');
  }

  async function sendMessage(text){
    const key = apiKeyEl.value.trim();
    if(!key){
      append('Please paste your OpenRouter API key at the top.', 'bot');
      return;
    }
    append(text, 'user');
    const thinking = append('...', 'bot');

    const payload = {
      model: MODEL,
      messages: [
        { role: "system", content: systemPrompt() },
        { role: "user", content: text }
      ],
      max_tokens: 60,
      temperature: 1.3,
      top_p: 0.9,
      n: 1
    };

    try {
      const res = await fetch('https://openrouter.ai/api/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + key
        },
        body: JSON.stringify(payload)
      });

      if(!res.ok){
        const t = await res.text();
        thinking.textContent = 'API error: ' + res.status;
        console.error('API error', res.status, t);
        return;
      }

      const data = await res.json();
      let reply = '';

      if(data.choices && data.choices[0]){
        const c = data.choices[0];
        if(c.message && (c.message.content || c.message.content === '')) {
          reply = c.message.content;
        } else if (c.text) {
          reply = c.text;
        } else {
          reply = JSON.stringify(c);
        }
      } else {
        reply = JSON.stringify(data);
      }

      thinking.textContent = (reply || '[empty]').trim();
    } catch(err){
      thinking.textContent = 'Network error';
      console.error(err);
    }
  }

  sendBtn.addEventListener('click', () => {
    const t = inputEl.value.trim();
    if(!t) return;
    inputEl.value = '';
    sendMessage(t);
  });

  inputEl.addEventListener('keydown', (e) => {
    if(e.key === 'Enter' && !e.shiftKey){
      e.preventDefault();
      sendBtn.click();
    }
  });

  // small UX: paste API key quickly via Ctrl+V focus
  apiKeyEl.addEventListener('keydown', (e) => {
    if(e.key === 'Enter') inputEl.focus();
  });
})();
</script>
</body>
</html>
